## 概念：

当出现函数嵌套的时候，内部函数访问外部函数的变量时，就是一个闭包

```js
function foo(){
    let name = 'zhangsan'
    return function fn(){
        console.log(name)
    }
}
//var func = foo()
//func()
foo()()
```

闭包形成的条件：

1. 函数嵌套
2. 内部函数访问外部函数的变量
3. 内部函数在创建以外的区域去调用

当js检测到内部函数在使用外部的变量时，会将这个变量保存到闭包空间，虽然外部函数销毁了，但是闭包空间还在，所以内部函数还能够使用该变量。

闭包的优点：

1. 延长了变量的作用范围（时间）
2. 避免了变量的污染（变量私有化）

闭包的缺点：

内存泄漏：1、某些变量意外的保存在了内存中没有被清除，2、没有被及时清除的定时器。

案例:

```js
for(var i = 0 ; i < 10 ; i++){
    // 定时器是一个异步函数，会在当前所有的同步代码执行完毕之后再去执行这个定时器
    (function(k){
        setTimeout(function(){
            console.log(k)  
        },1000*k)
    })(i)
}
```

#### js预解析：

浏览器之所以能够运行js代码，是因为有一个js引擎（v8 引擎），js引擎运行js代码的时候会做出2个步骤：

1. 预解析：在代码真正运行之前，会对代码进行一些额外的处理：变量初始化、提升、函数提升、上下文初始化.....
2. 执行代码：从上往下执行。

